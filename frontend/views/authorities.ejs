<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Authority Pannel</title>
  <link rel="stylesheet" href="/output.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center">
  <div class="w-full max-w-lg bg-gray-800 p-8 rounded-2xl shadow-lg mb-10">
    <h1 class="text-2xl font-bold mb-6 text-center">üõ† Authorities Panel</h1>

    <form action="/authorities/add-bus" method="POST" class="space-y-4">
      <input type="text" name="busNumber" placeholder="Bus Number" required class="w-full px-4 py-2 rounded bg-gray-700 text-white">
      <input type="text" name="route" placeholder="Route / Town Name" required class="w-full px-4 py-2 rounded bg-gray-700 text-white">
      <input type="text" name="status" placeholder="Status (On Time/Delayed)" class="w-full px-4 py-2 rounded bg-gray-700 text-white">
      <input type="text" name="nextStop" placeholder="Next Stop" class="w-full px-4 py-2 rounded bg-gray-700 text-white">
      <input type="number" step="any" name="lat" placeholder="Latitude" required class="w-full px-4 py-2 rounded bg-gray-700 text-white">
      <input type="number" step="any" name="lng" placeholder="Longitude" required class="w-full px-4 py-2 rounded bg-gray-700 text-white">

      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-semibold">
        ‚ûï Add Bus
      </button>
    </form>
  </div>

  <!-- Pending Requests -->
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-orange-400 mb-6">üìù Pending Bus Route Requests</h1>
    <table class="w-full border-collapse text-left glass-effect rounded-xl">
      <thead>
        <tr class="bg-gray-800">
          <th class="p-3">Town</th>
          <th class="p-3">Source</th>
          <th class="p-3">Destination</th>
          <th class="p-3">Reason</th>
          <th class="p-3">Status</th>
          <th class="p-3">Actions</th>
        </tr>
      </thead>
      <tbody id="requestsTable"></tbody>
    </table>
  </div>

  <!-- Municipal Approved (Forwarded) -->
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-green-400 mb-6">‚úÖ Municipal Approved Requests</h1>
    <table class="w-full border-collapse text-left glass-effect rounded-xl">
      <thead>
        <tr class="bg-gray-800">
          <th class="p-3">Town</th>
          <th class="p-3">Source</th>
          <th class="p-3">Destination</th>
          <th class="p-3">Reason</th>
          <th class="p-3">Status</th>
        </tr>
      </thead>
      <tbody id="approvedTable"></tbody>
    </table>
  </div>

  <script>
  async function loadRequests() {
    // Pending requests
    const res = await fetch("/api/bus-requests/pending");
    const data = await res.json();
    if (data.success) {
      const tbody = document.getElementById("requestsTable");
      tbody.innerHTML = "";
      data.requests.forEach(req => {
        tbody.innerHTML += `
          <tr class="border-b border-gray-700">
            <td class="p-3">${req.town}</td>
            <td class="p-3">${req.source}</td>
            <td class="p-3">${req.destination}</td>
            <td class="p-3">${req.reason}</td>
            <td class="p-3 text-yellow-400">${req.status}</td>
            <td class="p-3 flex gap-2">
              <button onclick="updateStatus('${req._id}','Forwarded')" class="px-3 py-1 bg-blue-500 rounded">Forward</button>
              <button onclick="updateStatus('${req._id}','Rejected')" class="px-3 py-1 bg-red-500 rounded">Reject</button>
            </td>
          </tr>
        `;
      });
    }

    // Approved requests (forwarded by municipal)
    const res2 = await fetch("/api/bus-requests/approved");
    const data2 = await res2.json();
    if (data2.success) {
      const tbody2 = document.getElementById("approvedTable");
      tbody2.innerHTML = "";
      data2.requests.forEach(req => {
        tbody2.innerHTML += `
          <tr class="border-b border-gray-700">
            <td class="p-3">${req.town}</td>
            <td class="p-3">${req.source}</td>
            <td class="p-3">${req.destination}</td>
            <td class="p-3">${req.reason}</td>
            <td class="p-3 text-green-400">${req.status}</td>
          </tr>
        `;
      });
    }
  }

  async function updateStatus(id, status) {
    await fetch(`/api/bus-requests/${id}/status`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ status })
    });
    loadRequests();
  }

  loadRequests();
  </script>
</body>
</html>
